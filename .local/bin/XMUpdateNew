#!/usr/bin/env zsh
# Author - Haron Prime
# License WTFPL  http://www.wtfpl.net/

TMP=`cat /tmp/haron/ChU`
function return1 {
    if [[ $UPD -eq 1 ]]; then
        PKG='package'
    elif [[ $UPD -gt 1 ]]; then
        PKG='packages'
    fi
    echo $UPD > /tmp/haron/ChU
}
function return2 {
    echo $UPD > /tmp/haron/ChU
    echo "<fc=#0e0> System is up to date</fc>" > /tmp/haron/UP
    sleep 5 &&
    echo "<action=XMUpdateNew><fc=#0e0></fc></action>" > /tmp/haron/UP
}
if [[ $TMP -eq 0 ]] || [[ -z $TMP ]]; then
    UPD=`checkupdates | wc -l`
    if [[ $UPD -gt 0 ]]; then 
        return1
        echo "<action=XMYAY><fc=#fb0> $UPD $PKG can be updated</fc></action>" > /tmp/haron/UP
    else 
        return2
    fi
else
    urxvtc -name update -e yay -Syu &&
    while [[ -n $(pgrep yay) ]]; do 
        sleep 1
    done
    UPD=`checkupdates | wc -l`
    if [[ $UPD -eq 0 ]]; then
        return2
    else
        return1
        echo "<action=XMYAY><fc=#fb0> Update do not complete! $UPD $PKG can be updated</fc></action>" > /tmp/haron/UP
    fi
fi
exit 0
