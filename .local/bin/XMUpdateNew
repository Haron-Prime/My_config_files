#!/usr/bin/env zsh
# Author - Haron Prime
# License WTFPL  http://www.wtfpl.net/

function return1 {
    if [[ $actual_value -eq 1 ]]; then
        unit='package'
    elif [[ $actual_value -gt 1 ]]; then
        unit='packages'
    fi
    echo $actual_value > /tmp/haron/ChU
}
function return2 {
    echo $actual_value > /tmp/haron/ChU
    echo "<fc=#0e0> System is up to date</fc>" > /tmp/haron/UP
    sleep 5 &&
    echo "<action=XMUpdateNew><fc=#0e0></fc></action>" > /tmp/haron/UP
}
previous_value=`cat /tmp/haron/ChU`
if [[ $previous_value -eq 0 ]] || [[ -z $previous_value ]]; then
    actual_value=`checkupdates | wc -l`
    if [[ $actual_value -gt 0 ]]; then 
        return1
        echo "<action=XMUpdateNew><fc=#fb0> $actual_value $unit can be updated</fc></action>" > /tmp/haron/UP
    else 
        echo "<action=XMUpdateNew><fc=#0e0></fc></action>" > /tmp/haron/UP
    fi
else
    urxvtc -name update -e yay -Syu &&
    while [[ -n $(pgrep yay) ]]; do 
        sleep 1
    done
    actual_value=`checkupdates | wc -l`
    if [[ $actual_value -eq 0 ]]; then
        return2
    else
        return1
        echo "<action=XMUpdateNew><fc=#fb0> Update do not complete! $actual_value $unit not updated!</fc></action>" > /tmp/haron/UP
    fi
fi
exit 0
